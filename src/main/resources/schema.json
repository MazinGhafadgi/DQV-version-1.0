{
  "$schema": "http://vonneumann.com/schemas/myschema.json#",
  "type": "array",
  "uniqueItems": true,
  "items": {
    "$ref": "#/definitions/Welcome5Element"
  },
  "definitions": {
    "Welcome5Element": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "process.type": {
          "type": "string",
          "enum": ["Batch", "Streaming"]
        },
        "sink.type": {
          "type": "string",
          "enum": ["Console", "BigQuery"]
        },
        "report.type": {
          "type": "string",
          "enum": ["Percentage", "Count"]
        },
        "source": {
          "$ref": "#/definitions/Source"
        },
        "target": {
          "$ref": "#/definitions/Target"
        },
        "rules": {
          "type": "array",
          "uniqueItems": true,
          "items": {
            "$ref": "#/definitions/RuleElement"
          }
        }
      },
      "required": [
        "process.type",
        "report.type",
        "rules",
        "sink.type",
        "source"
      ],
      "title": "Welcome5Element"
    },
    "RuleElement": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "rule": {
          "$ref": "#/definitions/RuleRule"
        }
      },
      "required": [
        "rule"
      ],
      "title": "RuleElement"
    },
    "RuleRule": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string"
        },
        "value": {
          "type": "string"
        },
        "description": {
          "type": "string"
        }
      },
      "if": {
        "properties": { "type": { "const":  "StatisticsRule"  } }
      },
      "then": {
        "properties": { "value": { "pattern": "(^MIN|MAX|AVG)" } }
      },
      "else": {
        "properties": { "value": { "pattern": "." } }
      },
      "required": [
        "description",
        "type",
        "value"
      ],
      "title": "RuleRule"
    },
    "Source": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "source.type": {
          "type": "string",
          "default" : "CSV",
          "enum": ["CSV", "Parquet", "BigQuery"]
        },
        "source.path": {
          "type": "string",
          "default": "projectId.dataset.tableName"
        }
      },
      "if": {
        "properties": { "source.type": { "enum": ["CSV", "Parquet"] } }
      },
      "then": {
        "properties": { "source.path": { "pattern": "^gs://" } }
      },
      "else": {
        "properties": { "source.path": { "pattern": "[a-zA-Z0–9-_.]+\\.[a-zA-Z0–9-]+\\.[a-zA-Z0–9-]" } }
      },
      "required": [
        "source.path",
        "source.type"
      ],
      "title": "Source"
    },
    "Target": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "target.type": {
          "type": "string",
          "default" : "CSV",
          "enum": ["CSV", "Parquet", "BigQuery"]
        },
        "target.path": {
          "type": "string",
          "default": "projectId.dataset.tableName"
        }
      },
      "if": {
        "properties": { "target.type": { "enum": ["CSV", "Parquet"] } }
      },
      "then": {
        "properties": { "target.path": { "pattern": "^gs://" } }
      },
      "else": {
        "properties": { "target.path": { "pattern": "[a-zA-Z0–9-_.]+\\.[a-zA-Z0–9-]+\\.[a-zA-Z0–9-]" } }
      },
      "required": [
        "target.path",
        "target.type"
      ],
      "title": "Target"
    }
  }
}
